
openapi: "3.1.0"
info:
    version: 2023.12.1
    title: BringYour
    description: |
        BringYour is a web-standards VPN marketplace with an emphasis on 
        fast, secure internet everwhere.

        The API for BringYour bootstraps the `connect` protocol,
        and is the source of JWTs and other match-making transactions.
        
        The JWT returned by /auth routes does not have a clientId.
        The `connect` protocol requires a JWT with a clientId.
        Use the /network routes to obtain a JWT with a clientId.

        In the BringYour network:
        - a network name is a globally unique subnet (xyz.bringyour.network)
        - a clientId is a globally unique 16-byte address
        - clientIds are equivalent to IPv6, but are expressed as UDID
        - clients also have an IPv6 and IPv4 mapped to their clientId
        
        Outside of IP translation like taptun/utun, 
        clients are typically addressed via their clientId.

        Unless otherwise specified, time/date strings will be formatted
        in the Go default `2006-01-02 15:04:05.999999999 -0700 MST`.

    termsOfService: https://bringyour.com/terms
    contact:
        name: BringYour
        email: support@bringyour.com
        url: https://bringyour.com
    x-logo:
        url: https://bringyour.com/res/images/bringyour-wordmark.png
        altText: BringYour
    license:
        name: Mozilla Public License, v. 2.0
        url: https://mozilla.org/MPL/2.0/
servers:
    - url: https://api.bringyour.com

security:
  - BearerAuth: []

paths:
    /stats/last-90:
        get:
            description: |
                Get network statistics for the last 90 days.
                The statistics are updated approximately every 60s.
            operationId: Stats Last 90
            security: []
            responses:
                "200":
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/StatsResult"

    /auth/login:
        post:
            description: |
                Start a login for a user authority.
                The user authority may be:
                - email
                - phone number
                - Apple JWT
                - Google JWT
            operationId: Auth Login
            security: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/AuthLoginArgs"
            responses:
                "200":
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/AuthLoginResult"
    
    /auth/login-with-password:
        post:
            description: |
                Password login for email and phone number.
            operationId: Auth Login With Password
            security: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/AuthLoginWithPasswordArgs"
            responses:
                "200":
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/AuthLoginWithPasswordResult"

    /auth/verify:
        post:
            description: |
                Verify ownership of email or phone number.
            operationId: Auth Verify
            security: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/AuthVerifyArgs"
            responses:
                "200":
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/AuthVerifyResult"

    /auth/verify-send:
        post:
            description: |
                Send verification code to email or phone number.
            operationId: Auth Verify Send
            security: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/AuthVerifySendArgs"
            responses:
                "200":
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/AuthVerifySendResult"

    /auth/password-reset:
        post:
            description: |
                Send password reset code to email or phone number.
            operationId: Auth Password Reset
            security: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/AuthPasswordResetArgs"
            responses:
                "200":
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/AuthPasswordResetResult"

    /auth/password-set:
        post:
            description: |
                Change password.
            operationId: Auth Password Set
            security: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/AuthPasswordSetArgs"
            responses:
                "200":
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/AuthPasswordSetResult"

    /auth/network-check:
        post:
            description: |
                Check if the network name is available.
                A new network name must satisfy:
                - at least 3 characters different from an existing network name
                - at least 8 characters
                - domain name compatible (see RFC 5890)
                - not contain the dash (-) character (BringYour subdomains are reverse-flattened to a single level using dashes)
            operationId: Auth Network Check
            security: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/NetworkCheckArgs"
            responses:
                "200":
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/NetworkCheckResult"

    /auth/network-create:
        post:
            description: |
                Create a new network.
                A user authority can be associated with at most one network.
            operationId: Auth Network Create
            security: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/NetworkCreateArgs"
            responses:
                "200":
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/NetworkCreateResult"

    /network/auth-client:
        post:
            description: |
                Gain permission to use the `connect` protocol as the requested clientId,
                or assign a new clientId.
                Each network can have at most 128 clientIds.
                Above that number, new clientId requests will error until one or more
                existing clientIds are removed.
            operationId: Auth Network Client
            security:
                - BearerAuth: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/AuthNetworkClientArgs"
            responses:
                "200":
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/AuthNetworkClientResult"

    /network/remove-client:
        post:
            description: |
                Remove a client from the network.
            operationId: Remove Network Client
            security:
                - BearerAuth: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/RemoveNetworkClientArgs"
            responses:
                "200":
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/RemoveNetworkClientResult"

    /network/clients:
        get:
            description: |
                Get the latest status of all clients on this network.

                Includes:
                
                - Resident status, which is the platform counterpart
                for the client that handles control commands.
                - Connections, which are transports from the client to the platform.
                Note there can be multiple active connections for a single client.
                - Provide status
            operationId: Network Clients
            security:
                - BearerAuth: []
            responses:
                "200":
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/NetworkClientsResult"

    /preferences/set-preferences:
        post:
            description: |
                Set account preferences.
            operationId: Preferences Set
            security:
                - BearerAuth: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/PreferencesSetArgs"
            responses:
                "200":
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/PreferencesSetResult"

    /feedback/send-feedback:
        post:
            description: |
                Feedback.
            operationId: Feedback Send
            security:
                - BearerAuth: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/FeedbackSendArgs"
            responses:
                "200":
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/FeedbackSendResult"

    /network/provider-locations:
        get:
            description: |
                A list of locations and groups where there are at least one active provider
                in good health. 
                Note that a location or group will need to be mapped to an actual provider
                using `/network/find-providers`.
            operationId: Network Provider Locations
            security: []
            responses:
                "200":
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/FindLocationsResult"

    /network/find-provider-locations:
        post:
            description: |
                Search for locations and groups that match a query,
                where there are at least one active provider in good health. 
                The match algorithm accounts for typos and misspelling,
                and the tolerance can be tuned in the input.
                Note that a location or group will need to be mapped to an actual provider
                using `/network/find-providers`.
            operationId: Network Find Provider Locations
            security: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/FindLocationsArgs"
            responses:
                "200":
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/FindLocationsResult"

    /network/find-locations:
        post:
            description: |
                Search for locations and groups that match a query,
                regardless of whether an providers are active.
            operationId: Network Find Locations
            security: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/FindLocationsArgs"
            responses:
                "200":
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/FindLocationsResult"

    /network/find-providers:
        post:
            description: |
                Randomly sample providers that for a location or group,
                which are active and in good health.
                This allows random iteration by using the exclude input to mark
                visited providers.
            operationId: Network Find Providers
            security: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/FindActiveProvidersArgs"
            responses:
                "200":
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/FindActiveProvidersResult"

    /wallet/balance:
        get:
            description: |
                Get the balance for the USDC user custody wallet.
                The user custody wallet allows BringYour to query the balance,
                but the user must take actions against the wallet.
            operationId: Wallet Balance
            security:
                - BearerAuth: []
            responses:
                "200":
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/WalletBalanceResult"

    /wallet/validate-address:
        post:
            description: |
                Validate a USDC wallet address on the user custody wallet chain.
                This can be used to check whether an address can receive
                a transfer out from the user custody wallet.
                Please use this before initiating any transfer out to avoid lost funds.
            operationId: Wallet Validate Address
            security:
                - BearerAuth: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/WalletValidateAddressArgs"
            responses:
                "200":
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/WalletValidateAddressResult"

    /wallet/circle-init:
        post:
            description: |
                Initialize the Circle USDC user self custody wallet.
                This starts a process that must be completed by the user.
            operationId: Wallet Circle Init
            security:
                - BearerAuth: []
            responses:
                "200":
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/WalletCircleInitResult"

    /wallet/circle-transfer-out:
        post:
            description: |
                Set up a transfer from the Circle USDC user self custody wallet 
                to an address.
                This starts a process that must be completed by the user.
            operationId: Wallet Circle Init
            security:
                - BearerAuth: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/WalletCircleTransferOutArgs"
            responses:
                "200":
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/WalletCircleTransferOutResult"

    /subscription/balance:
        get:
            description: |
                Get the current subscription status and transfer balance.
            operationId: Subscription Balance
            security:
                - BearerAuth: []
            responses:
                "200":
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/SubscriptionBalanceResult"

components:
    securitySchemes:
        BearerAuth:
            type: http
            scheme: bearer
            description: BringYour JWT

    schemas:
        StatsResult:
            type: object
            properties:
                lookback:
                    type: integer
                created_time:
                    description: Unix epoch time UTC
                    type: integer
                all_transfer_data:
                    type: object
                    description: yyyy-mm-dd to count
                    additionalProperties:
                        x-additionalPropertiesName: yyyy-mm-dd
                        type: integer
                all_transfer_summary:
                    type: integer
                all_transfer_summary_rate:
                    type: integer
                all_packets_data:
                    type: object
                    description: yyyy-mm-dd to count
                    additionalProperties:
                        x-additionalPropertiesName: yyyy-mm-dd
                        type: integer
                all_packets_summary:
                    type: integer
                all_packets_summary_rate:
                    type: integer
                providers_data:
                    type: object
                    description: yyyy-mm-dd to count
                    additionalProperties:
                        x-additionalPropertiesName: yyyy-mm-dd
                        type: integer
                providers_superspeed_data:
                    type: object
                    description: yyyy-mm-dd to count
                    additionalProperties:
                        x-additionalPropertiesName: yyyy-mm-dd
                        type: integer
                providers_summary:
                    type: integer
                providers_summary_superspeed:
                    type: integer
                countries_data:
                    type: object
                    description: yyyy-mm-dd to count
                    additionalProperties:
                        x-additionalPropertiesName: yyyy-mm-dd
                        type: integer
                countries_summary:
                    type: integer
                regions_data:
                    type: object
                    description: yyyy-mm-dd to count
                    additionalProperties:
                        x-additionalPropertiesName: yyyy-mm-dd
                        type: integer
                regions_summary:
                    type: integer
                cities_data:
                    type: object
                    description: yyyy-mm-dd to count
                    additionalProperties:
                        x-additionalPropertiesName: yyyy-mm-dd
                        type: integer
                cities_summary:
                    type: integer
                extender_transfer_data:
                    type: object
                    description: yyyy-mm-dd to count
                    additionalProperties:
                        x-additionalPropertiesName: yyyy-mm-dd
                        type: integer
                extender_transfer_summary:
                    type: integer
                extender_transfer_summary_rate:
                    type: integer
                extenders_data:
                    type: object
                    description: yyyy-mm-dd to count
                    additionalProperties:
                        x-additionalPropertiesName: yyyy-mm-dd
                        type: integer
                extenders_superspeed_data:
                    type: object
                    description: yyyy-mm-dd to count
                    additionalProperties:
                        x-additionalPropertiesName: yyyy-mm-dd
                        type: integer
                extenders_summary:
                    type: integer
                extenders_summary_superspeed:
                    type: integer
                networks_data:
                    type: object
                    description: yyyy-mm-dd to count
                    additionalProperties:
                        x-additionalPropertiesName: yyyy-mm-dd
                        type: integer
                networks_summary:
                    type: integer
                devices_data:
                    type: object
                    description: yyyy-mm-dd to count
                    additionalProperties:
                        x-additionalPropertiesName: yyyy-mm-dd
                        type: integer
                devices_summary:
                    type: integer
        AuthLoginArgs:
            type: object
            properties:
                user_auth:
                    description: email or phone number
                    type: string
                auth_jwt:
                    type: string
                auth_jwt_type:
                    type: string
                    enum:
                        - apple
                        - google
        AuthLoginResult:
            type: object
            properties:
                user_name:
                    type: string
                user_auth:
                    description: email or phone number
                    type: string
                auth_allowed:
                    type: array
                    items:
                        type: string
                        enum:
                            - password
                            - apple
                            - google
                error:
                    type: object
                    properties:
                        suggested_user_auth:
                            type: string
                            enum:
                                - password
                                - apple
                                - google
                        message:
                            type: string
                network:
                    type: object
                    properties:
                        by_jwt:
                            type: string
        AuthLoginWithPasswordArgs:
            type: object
            properties:
                user_auth:
                    description: email or phone number
                    type: string
                password:
                    type: string
        AuthLoginWithPasswordResult:
            type: object
            properties:
                verification_required:
                    type: object
                    properties:
                        user_auth:
                            description: email or phone number
                            type: string
                network:
                    type: object
                    properties:
                        by_jwt:
                            type: string
                        name:
                            type: string
                error:
                    type: object
                    properties:
                        message:
                            type: string
        AuthVerifyArgs:
            type: object
            properties:
                user_auth:
                    description: email or phone number
                    type: string
                verify_code:
                    type: string
        AuthVerifyResult:
            type: object
            properties:
                network:
                    type: object
                    by_jwt:
                        type: string
                error:
                    type: object
                    message:
                        type: string
        AuthVerifySendArgs:
            type: object
            properties:
                user_auth:
                    description: email or phone number
                    type: string
        AuthVerifySendResult:
            type: object
            properties:
                user_auth:
                    description: email or phone number
                    type: string
        AuthPasswordResetArgs:
            type: object
            properties:
                user_auth:
                    description: email or phone number
                    type: string
        AuthPasswordResetResult:
            type: object
            properties:
                user_auth:
                    description: email or phone number
                    type: string
        AuthPasswordSetArgs:
            type: object
            properties:
                reset_code:
                    type: string
                password:
                    type: string
        AuthPasswordSetResult:
            type: object
            properties: {}
        NetworkCheckArgs:
            type: object
            properties:
                network_name:
                    type: string
        NetworkCheckResult:
            type: object
            properties:
                available:
                    type: boolean
        NetworkCreateArgs:
            type: object
            properties:
                user_name:
                    type: string
                user_auth:
                    description: email or phone number
                    type: string
                auth_jwt:
                    type: string
                auth_jwt_type:
                    type: string
                    enum:
                        - apple
                        - google
                password:
                    type: string
                network_name:
                    type: string
                terms:
                    description: user consent to accept terms of service
                    type: boolean
        NetworkCreateResult:
            type: object
            properties:
                network:
                    type: object
                    properties:
                        by_jwt:
                            type: string
                        network_name:
                            type: string
                verification_required:
                    type: object
                    properties:
                        user_auth:
                            description: email or phone number
                            type: string
                error:
                    type: object
                    properties:
                        message:
                            type: string
        AuthNetworkClientArgs:
            type: object
            properties:
                client_id:
                    description: udid
                    type: string
                description:
                    type: string
                device_spec:
                    type: string
        AuthNetworkClientResult:
            type: object
            properties:
                by_client_jwt:
                    type: string
                error:
                    type: object
                    properties:
                        client_limit_exceeded:
                            type: boolean
                        message:
                            type: string
        RemoveNetworkClientArgs:
            type: object
            properties:
                client_id:
                    description: udid
                    type: string
        RemoveNetworkClientResult:
            type: object
            properties:
                error:
                    type: object
                    properties:
                        message:
                            type: string
        NetworkClientsResult:
            type: object
            properties:
                clients:
                    type: array
                    items:
                        type: object
                        properties:
                            client_id:
                                description: udid
                                type: string
                            network_id:
                                description: udid
                                type: string
                            description:
                                type: string
                            device_spec:
                                type: string
                            create_time:
                                type: string
                            auth_time:
                                type: string
                            resident:
                                type: object
                                properties:
                                    client_id:
                                        description: udid
                                        type: string
                                    instance_id:
                                        description: udid
                                        type: string
                                    resident_id:
                                        description: udid
                                        type: string
                                    resident_host:
                                        type: string
                                    resident_service:
                                        type: string
                                    resident_block:
                                        type: string
                                    resident_internal_ports:
                                        type: array
                                        items:
                                            type: integer
                            provide_mode:
                                type: integer
                                oneOf:
                                - title: ProvideModeNone
                                  const: 0
                                - title: ProvideModeNetwork
                                  const: 1
                                - title: ProvideModeFriendsAndFamily
                                  const: 2
                                - title: ProvideModePublic
                                  const: 3
                                - title: ProvideModeStream
                                  const: 4
                            connections:
                                type: array
                                items:
                                    type: object
                                    properties:
                                        client_id:
                                            description: udid
                                            type: string
                                        connection_id:
                                            description: udid
                                            type: string
                                        connect_time:
                                            type: string
                                        disconnect_time:
                                            type: string
                                        connection_host:
                                            type: string
                                        connection_service:
                                            type: string
                                        connection_block:
                                            type: string
        PreferencesSetArgs:
            type: object
            properties:
                product_updates:
                    type: boolean
        PreferencesSetResult:
            type: object
            properties: {}
        FeedbackSendArgs:
            type: object
            properties:
                uses:
                    type: object
                    properties:
                        personal:
                            type: boolean
                        business:
                            type: boolean
                needs:
                    type: object
                    properties:
                        private:
                            type: boolean
                        safe:
                            type: boolean
                        global:
                            type: boolean
                        collaborate:
                            type: boolean
                        app_control:
                            type: boolean
                        block_data_brokers:
                            type: boolean
                        block_ads:
                            type: boolean
                        focus:
                            type: boolean
                        connect_servers:
                            type: boolean
                        run_servers:
                            type: boolean
                        prevent_cyber:
                            type: boolean
                        audit:
                            type: boolean
                        zero_trust:
                            type: boolean
                        visualize:
                            type: boolean
                        other:
                            type: string
        FeedbackSendResult:
            type: object
            properties: {}
        FindLocationsArgs:
            type: object
            properties:
                query:
                    type: string
                max_distance_fraction:
                    type: number
                enable_max_distance_fraction:
                    type: boolean
        FindLocationsResult:
            type: object
            properties:
                groups:
                    type: array
                    items:
                        type: object
                        properties:
                            location_group_id:
                                description: udid
                                type: string
                            name:
                                type: string
                            provider_count:
                                type: integer
                            promoted:
                                type: boolean
                            match_distance:
                                type: integer
                locations:
                    type: array
                    items:
                        type: object
                        properties:
                            location_id:
                                description: udid
                                type: string
                            location_type:
                                type: string
                                enum:
                                    - city
                                    - region
                                    - country
                            name:
                                type: string
                            city:
                                type: string
                            city_location_id:
                                description: udid
                                type: string
                            region:
                                type: string
                            region_location_id:
                                description: udid
                                type: string
                            country:
                                type: string
                            country_location_id:
                                description: udid
                                type: string
                            country_code:
                                type: string
                            provider_count:
                                type: integer
                            match_distance:
                                type: integer
        FindActiveProvidersArgs:
            type: object
            properties:
                location_id:
                    description: udid
                    type: string
                location_group_id:
                    description: udid
                    type: string
                count:
                    type: integer
                exclude_location_ids:
                    type: array
                    items:
                        description: udid
                        type: string
        FindActiveProvidersResult:
            type: object
            properties:
                client_ids:
                    type: array
                    items:
                        description: udid
                        type: string
        WalletBalanceResult:
            type: object
            properties:
                wallet_info:
                    type: object
                    properties:
                        wallet_id:
                            type: string
                        token_id:
                            type: string
                        blockchain:
                            type: string
                        blockchain_symbol:
                            type: string
                        create_date:
                            type: string
                        balance_usdc_nano_cents:
                            type: integer
                        address:
                            type: string
        WalletValidateAddressArgs:
            type: object
            properties:
                address:
                    type: string
        WalletValidateAddressResult:
            type: object
            properties:
                valid:
                    type: boolean
        WalletCircleInitResult:
            type: object
            properties:
                user_token:
                    type: object
                    properties:
                        user_token:
                            type: string
                        encryption_key:
                            type: string
                challenge_id:
                    type: string
                error:
                    type: object
                    properties:
                        message:
                            type: string
        WalletCircleTransferOutArgs:
            type: object
            properties:
                to_address:
                    type: string
                amount_usdc_nano_cents:
                    type: integer
                terms:
                    description: user consent to accept terms of transfer
                    type: boolean
        WalletCircleTransferOutResult:
            type: object
            properties:
                user_token:
                    type: object
                    properties:
                        user_token:
                            type: string
                        encryption_key:
                            type: string
                challenge_id:
                    type: string
                error:
                    type: object
                    properties:
                        message:
                            type: string
        SubscriptionBalanceResult:
            type: object
            properties:
                balance_byte_count:
                    type: integer
                current_subscription:
                    type: object
                    properties:
                        subscription_id:
                            description: udid
                            type: string
                        store:
                            type: string
                        plan:
                            type: string
                active_transfer_balances:
                    type: array
                    items:
                        type: object
                        properties:
                            balance_id:
                                description: udid
                                type: string
                            network_id:
                                description: udid
                                type: string
                            start_time:
                                type: string
                            end_time:
                                type: string
                            start_balance_byte_count:
                                type: integer
                            net_revenue_nano_cents:
                                type: integer
                            balance_byte_count:
                                type: integer
                pending_payout_usd_nano_cents:
                    type: integer
                wallet_info:
                    type: object
                    properties:
                        wallet_id:
                            description: udid
                            type: string
                        token_id:
                            description: udid
                            type: string
                        blockchain:
                            type: string
                            enum:
                                - Polygon
                        blockchain_symbol:
                            type: string
                            enum:
                                - MATIC
                        create_date:
                            type: string
                        balance_usdc_nano_cents:
                            type: integer
                        address:
                            type: string
                update_time:
                    type: string
